using Plugin.Firebase.CloudMessaging;
using System;
using System.Text.Json;
using System.Text;

namespace MAUIcontainer;

public partial class App : Application {
    public static Dictionary<int, FCMNotification> MessageQueue { get; private set; }
    public static List<MyApp> MyAppsArray { get; set; }
    public static string errmessage { get; set; }
    public static MyApp currentApp { get; set; }
    public static MainPage mainpage { get; set; }
    public static bool IsLogin { get; set; }
    public App() {
        InitializeComponent();
        currentApp = null;
        mainpage = null;
        IsLogin= false;
        MessageQueue = new Dictionary<int, FCMNotification>();
        MyAppsArray = new List<MyApp>();
        //Should call a Apps Management API to retrieve based on authentication token.
        MyAppsArray.Add(new MyApp() {
            Name = "Demo1",
            Description = "Test AAD, Fingerprint, Push Notification, Telerik doc/report/UI",
            BlazorNamespace = "Client",
            BlazorUrl = "https://mauiclient.z23.web.core.windows.net/",
            Imagestream = ImageSource.FromStream(() => new MemoryStream(Convert.FromBase64String("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")))
        }); ;
        MyAppsArray.Add(new MyApp() {
            Name = "Demo2",
            Description = "Test AAD, Camera, Push Notification",
            BlazorNamespace = "Demo2Client",
            BlazorUrl = "https://mauiphoto.z23.web.core.windows.net/",
            //BlazorUrl = "https://192.168.0.30:7196/",
            Imagestream = ImageSource.FromStream(() => new MemoryStream(Convert.FromBase64String("iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAIAAAC1nk4lAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABQPSURBVGhDzZr3dxRXlsf379kf9uzZs7tjm6QE2JhhbY/jOOCdGc86rcczY4NAUrcSyUTjwdgmDBbYApMzAhEEAnVWt9QKKGd1zt2VOuznVWk0PjMHDbLxOXtPnaL6dXW977vve7/33hL/VPhpTFPlsS+abMuqtZyqZrWZ0Udkjwx0XrfZC1WR+uqPd/58s5aWpLScz2dzhTyHYcZPfrD9JKBzuZyWSPd9dLjrrb3B1u7JQ9cZ0BHr3xb+34CeNYE9n5cmAh1v7Jy+3SnFJM8rmya/uZllLQXh72z+x7LlpwKd6B3vXb1bmQrls4XhHae739ytSKpSMPydnbn1h9pPBTp009v3v/vlVDxdyIY9w66y6njPWD6naXDjx4NmgpnLOY2bcJLuJ2HGNQgwgaOQM0INDnCB3Td/07/xZEaTlFw2G0zal1ZPnbEUZEXNF7JZdeahP9QeFjSAVEFKHVE+x6HlsplCVkPS8uJbmMqgrH8fvOyyLjVNNrTwLaBVWel4bmufqVFOpXURUWYe+kPtYemBIIDGAA1c3MpZBgAL0QpKIafkhR6rBS1u6bMtMztLzYELjpyiihvSivuZLR2/+CQ5FoAaMHvmoT/U5sFpvAg4cBeYOJdXUnJWViADC5BycCSLrimK1P76DkdJtWNpte+cjRF2ICOnPS9stS+pDDV3yNkcC5t54g+1hwUtWARQ4e48uyu5x7yv7pAGggVFARYmPJrNTR+60V5a6yiqshSZ+j48GLMOZLon82l16IODtv9YR7rJqvqdP84eGnShAKclwOMqWes1Nbhf3ZmajsuFLN5lJZnpiO/UvfYVNZYSs62owllcbV+4/s7CtfYF5faVZsuqGvcCc095AwwnEA3B5ix8wF7pkW1El/7xH8jLPDyNh3gsmxuw97sWV/a8t18ORfB9JpH0N97peGkHKF0lNa4lZmtptQBdbHaV1XKGLa4lVZaSKjQk2OxWo0kVfuUEuScv2JRAlCVISDiLIXLy2qMELVJaDn1QeyoarIvWd3/cIEdjEKN/w1EBqFgcsKK9qFpwuqjKVSLCkcNWamIltiKTu7jG8ZS5d+2h9HCQKIBo3eYG/3dtuBtfyDkF4IBmB2ZmfYDNIxD1Pc0Sju1P1kLc/spvs8mUllHtRRXtJfUCa5HZVlINbntpjaOsFpTWJVX2hZXOxSZWhdfZB/vS+nuLK+8uXhO85SUe/A237M9sUgMpIpZQJkINYZ2Z8gE2D08LRRZSl7WWVLL7w1tOaZLsv+K0llQ5i+qtxTUM4tH2pTWdv9jW9d6Xg5WNI1vPjey40L/hRF9FY/fru10r6lhbR3F9R1GNc2Xt9GlLomPU+VRdT/khLZYRRayeAQxyz2EPC9qIG/HccMpaanIurhw/eD3aNWJfCVYTcPExnGkrrQyedyS9E4HRieMN3wTHJnOJjOQLn208PersDd7rcT+70ba4wlJWTVQ4ltWo0+HO97+0P14uSCKyji6Sjwq0zmnBtphrGHydKzdNHLhpX2aGuISavcw8vONUZjJMLE0PjWcz6pnvTo0NjCix9PGGxkwsxcjNqzdOHj3BmuVgYnjrCXuZyVFc631jl+/EPdvCctfyWn9Tp1YQsfgIQQs38zj/KZvl8bXk5N73D7SVVonYWl4daLynhNJSJJlPy6P9w0ok1XbjTmB0SgoluFajaTma6vP2shItks7GJSUpDW0+SYw6SkwD1cc6X97hWFQxsusimUDQY2bOB9o8QOs7l/PvvQ49xnZdYMq2YpOnqMZ3rDUraUooKScyajyVi6RFVRSX1HimIGVxLV+BOx2KawmJNbju2q5fvpYaCrhe286mOVdu6F29x75gXd8Hfxaqx1Qzcz7QHp7TQowIlLHtF/p/u8/95g6UAWkD98T94VUlZb7x6QvHTtfV1GeC8d3bdoUn/Hi6cs16oMvhJIORcb/AHcucP3n2/bffycvq1NEWZMdaLNTQvsTkWb07q6Hf6PQjC0RSGYVlbmzvlfbntzqEMJspJ9pf3BIORiy2NlwYGp2e6h8FVtPV5qQvAsSrF66cO3Hm2rnLIz0D2zZ+EveFIUwmnAiN+7RYKj0VdiwytxcRx0S2qfON3eynnlweXSCCm4I0cOKuLm3kjhrbY2umzrSNe/vJarACGmRCqT1bP5senORjxh+D37ZWy1jPoBRPh6eD6WiykFIFy8OZfDiZjafbFlVAs9ayqs7F1d5XdqmqLGZ5ZJ4WCZbGQ6PGmEFcaoqctkX9+C2Gdy+fvTjU1ZeNZmAzYUeopYIxnOpuc/CtEI1wMp9Uzn93mk1Qo9Kgtyc4Nt712qfQzLOk2rqkou/drzRNJMW5kwtLmoenKTMo9KI9E0Yh4X11V3I4EJ0IBCb91HGnjp6439kz4OkBXC6l3LjSDK25+GrnHlaCzLEYqJJNylIgzv2f1G9sPPh179oG2AynW4vW91QcKWgzfeTMrH9nwJgP6IIoZdCP8cYW0jXl8lDtsWwwnQ0nfL4ATEWJcfCif3uskNbw7vOrnotNh2ACBzLHGbjsRi4h56MZPkangkTw8O4LgEaw3cXm3t8fVDRZdBgPoIeBGJtHIMIOntbzh/2OsnpCkKSQDySzwfh777wfnwiCAx8HR6aA1d/R03T+MqwQOgh3oxnwtV67hSYKkRacFgcKON14mzLLWVQLdO/L2yhs5siIBmLs4ekh4hpvibxdUud4sjZmH0SVAX2v5W54zJeLSXiUM5jgrpZW0OZ8XOYMUOuN1o0VNWzIucaTXQ5PNiZAZ+Lp4FmbrcxsL6pBsF1P1SY8A4nhyQfRA7iizszlHgia/ol1Q2KRpdJZLZuhKE3bh61PlDuW1Hhe3xEbD6QiCWQYTFkySCQVGJ4c7xvOSdql42e/++ZYXs4e/+YYN7CYyGRg1NvPRbezwzc8kQulQtPBAbc3cN3jXFZtKxNVOKwb29M0ta9ZlE2yolc7opsGqwHJAE3f8EDQIp1mRXdNxzq45TgiTWhPNd62PrbOutA0WH7kaMO31BWTIxPAvdF0neRy7dLVzz7ZSQjaLPaG/YeIwm63F9D4+/i33/V5uiEM5OF+LZBADY8d+DrU4qXQpXQRqr+wcnTL+Z4PD0jJFF0ZSAEtYMwLtMo2yVp6ItT+WNXUn2/i+/41h2wLKiw/K6eUAxM6AGEgLlsCcdlxCAA3CDXOjIdHpvExDAE6cOF3xZr1Az39QtRj6Uw4RutOvUoU6kVipfft/XQPqe4xw8fMyIUBehYxsjsXPcQvs1pmNGBdbO5ff1iVla53v7AvNFEnxOwDQn2phMJJsh34JofHkTyQge/erdbbTTdEzIWSVFG4luyI6nG03rwT9oVY4ckjx2orTbG2++1P13tALPKryf3iTgrX0B2P3sLooP9S9D0UaG406CEPTduW1net/jQTiPT8+k+OBSLrJvqmDSFTU3Kn01OICKBf/ekL1koInjh89O7NO4LNsQz5Ba+Tz5vPXuYnIu/odR+SNzU2Dmj30/XUeiIQaW2W1dNoBq/ZwYex1YYJPA8FmlvFmxk1Mxa0LKvt/K/Nqd6prtU7bYvM9BryRJg4O3jwkMlUDTj2WsgZiSOUGOodgDkCXzjJAkg6+DUw4UNhcLz4KiGlEmnC8cKpM7G7ve0r6ujQ3NRMK+tcCyssxZXj1g46OwFRJ/SsMQLiuTjN6tBmTZVxlXN5rePJmnBrd9dbnzkWVNIBTHUNUl72dHT/8oVXcNtwdz8FNKUcQHd+skNNK6AXCp2UoY1AH8sAHa6TxmGOnJQ89xzbN20JN3dQjtNT0gq5Xt5mfXxt+9MbYv0T4t2gjlJHKy4ww81zeRpC0y9T4EqSRHtC3qZu9v7+gOOJCu+Kje47tnd+8/bE8Di5mhrowqlztZXVyXCc3e/t6IYzHnt7r7NT0MAfHh8UpR9uRhlB3OPqND6yRZErbueyGmup6N7db3xqW7Cu+zd7lXAciGCYxa1jngGtqupcoLmP5E0stj3+sbO0pr/u+GDtcSTPs7wuPuYPBcI4rJDRALp/7z7/yCR7Aqdbmm/BnMvnLjWdulBIKBdPn//vV1fTZAMRecHfMMc4MxI6aaHwonWHFfff/Ny5pGL8y6voHaa7+K+gQfyPPS3crL9OBr37pU+gsmt5zf31R9hHy+PrYi1dQDSVV/5p6y7DnfGpUMIfee+td4AiFC0pMQ5KocqxTCwYbTx4mIK77fa9eDCKm7n5V6+9Of5FE6IBPSjCyLLhW116EyAyOSZQglavLg3DzYqizOFpkVZkXUMm9zVTOosdXP2Zq6za9thaX0MrHCAjKrGkFIqRvYGIy4P+EBygeEI9RnsHjQBlnG8N0diz8zMKKRaD/N13dw1UN9oWVwmxQ6qL16mqeK9i9AGzoNnqWcSyLM8Fmt/gZvHSM6eqgZRzVR2PhiSoUttja/pqTyC9ZLV4NCaHYiKfR9MjfUMrV/xcQyLk7GsvvXrnegsLu329hW6cGto3KCJSpKR4Gm6IKiWU7Hn/C8eiKvSO5nxib1MeYuiuNczAarDC8PE/AA0r+DH/UHIohcLo5xchBsUNWQCXe17bZb96e3P9BqY52XAUlDiVQLTdtUIGsBKj0AByb9+8DWdTrO7b9TkOxs29eg6SibZQwv3iFgpG58Kq7j/+maaBSZUcbhKCN8tgUILY+Mh1JpOZCzQ/5h94QjgmBnzeV3fYl5nFK68i8Rpp+lYH2UGLJkkuSkqm2Lhy7lJBybVbnY1ff4NH4QNJEXnhIhmIQmhca7/dtv7jdXTp8Ipaz7FMdEC2f/8oeM2jlzeahH9nom4GNBcGWwzj4xz0gF7ijyOQKp1XVC03fdbqWLiWMCfY2xdVTn51DTYXoHJEvDn48rO9zZevQZKuzu7LF6+ISjWU5EC80QpwGyrODYIhYQIgkUtJlsWV1NOelXVCy3Oy7mCm0uVDNyAyaEDCDNxzgcbHgllCQMRacYCWlgLf3SaBuYrrcFL8Vtdg79Bk/0DGn+zvut9y7SZ8OHviDNKBtnhdHW//+n/YB/O6KjL59QtNd5tbgI6ub6jf0nKxKe2LEoWu5WbqKqDKqpQhLWQzon/RScyZeQHDBWyGGFzw8YGg/8YEW6iwieZC3vnsJkKHRND1wQHcQizC45Yr1yE3eRu+8hEJp1RCKyL+8ME9X6WmI4WkykEIcly6dGV6aDzS2ksZ3Vv1rRZXYEVWU6jJgA5ouIsZPga3gTidTnOeix5/Y2JXcD6SmcuOf37J8US5qNwXVk2eulv+hzW5hKj4CrrwkcBpE082HveNTdHAEqBaRoXcEMBIiqg45QdBObLnknvFpoFtZ8cOXJW0LMBmJEIVkQdQ8Bmz8xG4Bm5umAdoClzRR6gaYtf+Qr1zseii25/Z1NTUBE0JNXCQWRCBuC8cDURAL/Q4Kg7IA2HQZkaADklSI8HO3+6xr9ro+vkG77Ob0hA9p4i/kol4FK8hYYJBBoyPrAHE1BQsYB6geRagKWWkQi58yWkrqnQsNbeX1Kf84XRGfftXv21rvp2OJq+du/yv//wvtLrQg0MNJsjhK5etoIBmHyLjftYA7vi1TstT1c5FFZYn1jh+vY1dBzQMNCKP6TjjVLG/ujEOaKCzknlwmupWKhTQ7PQUvXeit/Iw2ods+4+0QANKDio4tCwdiIlcCBP0AgPdoLgLjfuMRHj26MlDe/fjsm7TEaSDlSOjfms3lOBQxPsD4xAo4QMQDdAYIxgX8/C0+JNcXjh7aNOxkS8vR20D3S9sRwE7nqwPX+mgClWjSQWfUxjJORFwCcnWahFUjgjXkhRjo774VGBqaip202tZXgW7bEtNIweajTgTXpxRKuFsaJBKpQxm65iFGWAeFjQhiBvgHCLKQxKWgY5Vmx1P17Wv2kQjQwnvfnFT+Hb3tq27ZH9kg7nm8IGvtQSNYPLyqfMwmHYwOuGLTfqDrT3tr+9gf+6WVbWvrIXCakHUCkbkAcvghjEpI1AC6CwJqoAex8+D09ADxAVFTJCmJFE1KrKOl7dan1gv/nZBeVlU1fncZt85h5JMo12o8kT/EBmk6czFdCwlTcWSnlH/RYdz1QZY0Va0vu93+3w3PUYqEQqtKwMosVlKGP4GLufvX8yDHjwC8Rf/hwAJKWh5VUoNBXrfPeAqqaFFEDVJicmzoDzhGSMt7d93aGRoFNn2n7P2mQ53/nK7/UnT3eL1pNKu13bHPCNwhgfiPHiBJmAGbsO136ey4XsM0Ixj8wAN04zyGpej1/BblI2SRtEjquGSavG32mW1luXm+2/uGfnjkb4PD9pf2Wb5z49IQ+wDfStS0/Xu5zQQSUWi4IRvkqSjzCRBDG7cbKDHAPfXqXXDx/ME/ZcfE4hGdswRmTA8r6SHfFMn7t4vP9z+ynbP0lrxbm5Rhe3x9dRuNJQUWO4l1ZayasZpNFOToYwmzcZWQk4l5RT0AAqDYiJdJUAPbq5nZtcHDcRcPCzoBxmPY/swaqbMZDTT46fUFBBLa+z63yXYAdG3Fle7n90YutkpeCmLkOIn/Jwz1zwEM55mGOMGufnWsFnE2I8FjelzCJdnNQmPeF7e3lFah4QDlI5Vx21yP78x4h0VfMgJPWZ6YBn4/t6MZ3IPuGeDDwMuv8IeAWhMJwz/5KlmqQRDLV7PC1tEh/azta6na0LWQeDqflJRi5QsUrHwmw4d44IRIMJvLgzoxiCm3yh8bIxjjwa0oHcBWdE3Tyd9KiEFb3snGm7EBybBKlFOUMZpWhr/EdC6AQhHgtUwQpCPM7h00LOmP/dRgxZOpsLQXw0bHZ5wKtWCmJoGIgNicCPgfKKGMaBgBm7DwP19ZDN36Ij1/ZihU6FQ+D/VlMXbO1gt0wAAAABJRU5ErkJggg==")))
        });
        MainPage = new AppShell();

        CrossFirebaseCloudMessaging.Current.NotificationReceived += Current_NotificationReceived;
        CrossFirebaseCloudMessaging.Current.NotificationTapped += Current_NotificationTapped;
    }
    private string Add2Queue(FCMNotification message) {
        string jmessage = JsonSerializer.Serialize(message);
        if (!message.Data.Any(x => x.Key == "App")) {
            return null;
        }
        int hashcode = 0;
        if (message.Data.Any(x => x.Key == "gcm.message_id")) {
            hashcode = message.Data["gcm.message_id"].GetHashCode();
        } 
        else if (message.Data.Any(x => x.Key == "google.message_id")) {
            hashcode = message.Data["google.message_id"].GetHashCode();
        } 
        else {
            hashcode = (jmessage + DateTime.Now.Ticks.ToString()).GetHashCode();
        }
        errmessage += $"hashcode={hashcode};";

        if (!MessageQueue.Any(x => x.Key == hashcode)) {
            MessageQueue.Add(hashcode, message);
            return $"{hashcode}|{Convert.ToBase64String(Encoding.Default.GetBytes(jmessage))}";
        }
        return null;
    }
    private void Current_NotificationTapped(object sender, Plugin.Firebase.CloudMessaging.EventArgs.FCMNotificationTappedEventArgs e) {
        errmessage += "PM Tapped";
        string jmessage = Add2Queue(e.Notification);
        errmessage += $"MessageQ jmessage={(jmessage != null ? jmessage.Substring(0, 15) : null)};";
        if (jmessage != null && mainpage != null && currentApp == null && App.IsLogin) {
            errmessage += "LoadApp;";
            mainpage.LoadApp(this, null);
        }
        if (jmessage != null && currentApp != null) {
            if (e.Notification.Data["App"] == currentApp.Name) {
                MessagingCenter.Send<App, string>(this, "PushNotification", jmessage);
                errmessage += $"MessagingCenter app={currentApp.Name} jmessage={jmessage.Substring(0, 15)};";
            }
        }
    }
    private void Current_NotificationReceived(object sender, Plugin.Firebase.CloudMessaging.EventArgs.FCMNotificationReceivedEventArgs e) {
        System.Diagnostics.Debug.WriteLine($"PM Received:{e.Notification.Title}, {e.Notification.Body}");
        errmessage += "PM Received";
    }
}
